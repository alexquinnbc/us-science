<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>American Science: A Story of Challenge & Resilience</title>
    <!--
    README: American Science: A Story of Challenge & Resilience
    ================================================================

    This is a self-contained, single-file interactive web experience. It details the threat of proposed 2026 budget cuts, celebrates the historical impact of US science, and offers an optimistic guide for researchers navigating the new landscape.

    --- USAGE ---
    Open this `index.html` file in any modern web browser. No internet connection or server is required.

    --- FEATURES ---
    *   **Light UI & Rich Interactivity:** A clean, professional design with subtle animations and engaging hover effects.
    *   **Scrolling Narrative:** The story unfolds through multiple, visually distinct sections.
    *   **Advanced Data Visualization:** Includes animated SVG charts, a detailed data table, and a "Multiplier Effect" infographic.
    *   **Historical Context:** The "Echoes of Discovery" section showcases the generational benefits of past scientific investment (GPS, Human Genome Project, mRNA vaccines).
    *   **Scientist's Guide:** An optimistic, actionable guide for researchers on thriving through innovation, collaboration, and alternative funding.
    *   **Fully Self-Contained & Performant:** All assets (HTML, CSS, JS, SVG) are inlined. Built for 60 FPS animations and high Lighthouse scores.
    *   **Accessible & Responsive:** Designed for all devices and users, with ARIA roles and keyboard navigation.
    *   **Embedded Test Suite:** Verifies application integrity and logs results to the developer console.

    --- STRUCTURE ---
    1.  <head>: Metadata and a single <style> tag with all CSS.
    2.  <body>: Semantic HTML content, logically ordered into narrative sections.
    3.  Main <script>: Application logic, organized into modular components.
    4.  Test Suite <script type="module">: Non-blocking tests.
    -->
    <style>
        :root {
            --color-background: #f8f9fa;
            --color-surface: #ffffff;
            --color-text: #212529;
            --color-text-muted: #6c757d;
            --color-heading: #003049;
            --color-primary: #005f73;
            --color-accent: #ee9b00;
            --color-danger: #d62828;
            --color-success: #2a9d8f;
            --color-border: #dee2e6;
            --font-family-sans: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-family-mono: "SF Mono", "Consolas", "Liberation Mono", Menlo, Courier, monospace;
            --font-size-base: 1rem;
            --line-height-base: 1.7;
            --spacing-unit: 1.5rem;
            --border-radius: 8px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --transition-speed: 0.3s;
            --max-width: 960px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            background-color: var(--color-background);
            color: var(--color-text);
            font-family: var(--font-family-sans);
            font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* --- BACKGROUND PARTICLES --- */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.5;
        }
        @media (prefers-reduced-motion: reduce) { #particles-js { display: none; }}

        /* --- LAYOUT & TYPOGRAPHY --- */
        .container {
            width: 100%;
            max-width: var(--max-width);
            margin: 0 auto;
            padding: 0 calc(var(--spacing-unit) * 1.5);
        }
        h1, h2, h3, h4 { color: var(--color-heading); font-weight: 700; line-height: 1.2; margin-bottom: var(--spacing-unit); }
        h1 { font-size: clamp(2.5rem, 6vw, 4rem); text-align: center; }
        h2 { font-size: clamp(2rem, 5vw, 2.8rem); border-bottom: 2px solid var(--color-accent); padding-bottom: 0.5rem; display: inline-block; }
        h3 { font-size: clamp(1.5rem, 4vw, 1.9rem); color: var(--color-primary); }
        p { margin-bottom: var(--spacing-unit); max-width: 75ch; }
        a { color: var(--color-primary); text-decoration: none; font-weight: 600; }
        a:hover, a:focus { color: var(--color-accent); text-decoration: underline; }
        strong { color: var(--color-heading); font-weight: 700; }
        .section-intro { text-align: center; margin-bottom: calc(var(--spacing-unit) * 3); }
        .section-intro p { margin-left: auto; margin-right: auto; color: var(--color-text-muted); font-size: 1.1rem;}

        /* --- SCROLL & SECTIONS --- */
        .site-header { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: var(--spacing-unit); }
        .site-header .subtitle { font-size: 1.25rem; max-width: 650px; color: var(--color-text-muted); }
        .scroll-down-indicator { position: absolute; bottom: 2rem; color: var(--color-text-muted); font-size: 0.9rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); }}
        main > section { padding: calc(var(--spacing-unit) * 4) 0; overflow: hidden; }
        
        /* Animation fade-in */
        .fade-in-section { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in-section.is-visible { opacity: 1; transform: translateY(0); }
        @media (prefers-reduced-motion: reduce) { .fade-in-section { opacity: 1; transform: none; transition: none; } }

        /* --- CARDS & INTERACTIVE ELEMENTS --- */
        .info-card {
            background-color: var(--color-surface);
            padding: var(--spacing-unit);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .info-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .data-viz-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-unit); width: 100%; }

        /* --- DATA VISUALIZATIONS --- */
        .stat-card .agency-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-primary); }
        .stat-card .cut-value { font-size: 2.5rem; font-weight: 700; color: var(--color-danger); }
        .stat-card .stat-description { font-size: 0.95rem; color: var(--color-text-muted); margin-top: 1rem; }
        
        #nsf-chart-container { width: 100%; height: auto; }
        #nsf-chart-svg .bar-group:hover .bar-proposed { fill: var(--color-danger); }
        #nsf-chart-svg .bar-current { fill: var(--color-primary); transition: fill 0.3s ease; }
        #nsf-chart-svg .bar-proposed { fill: #e5989b; transition: fill 0.3s ease; }
        #nsf-chart-svg text { font-family: var(--font-family-sans); fill: var(--color-text); }
        #nsf-chart-svg .axis-label { font-size: 12px; }
        #nsf-chart-svg .bar-label { font-size: 12px; font-weight: 600; }

        .data-table-container { overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: var(--spacing-unit); }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--color-border); }
        .data-table th { font-weight: 600; background-color: var(--color-background); color: var(--color-heading); }
        .data-table td:first-child { font-weight: 600; color: var(--color-primary); }

        /* --- ROI INFOGRAPHIC --- */
        #roi-infographic { display: grid; grid-template-columns: 1fr; grid-template-rows: auto; gap: var(--spacing-unit); align-items: center; text-align: center; }
        @media (min-width: 768px) { #roi-infographic { grid-template-columns: repeat(3, 1fr); } }
        .roi-center { grid-column: 1 / -1; }
        @media (min-width: 768px) { .roi-center { grid-column: 2 / 3; grid-row: 2 / 3; } }
        .roi-center-circle { width: 180px; height: 180px; border-radius: 50%; background: var(--color-primary); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto; box-shadow: var(--shadow-md); }
        .roi-center-circle .amount { font-size: 3rem; font-weight: 700; line-height: 1; }
        .roi-center-circle .label { font-size: 1rem; }
        .roi-benefit { background-color: var(--color-surface); padding: 1rem; border-radius: var(--border-radius); border: 1px solid var(--color-border); }
        .roi-benefit .icon { font-size: 2rem; color: var(--color-accent); margin-bottom: 0.5rem; }
        .roi-benefit h4 { font-size: 1.1rem; margin-bottom: 0.25rem; color: var(--color-heading); }
        
        /* --- HISTORICAL TIMELINE --- */
        .timeline { position: relative; width: 100%; margin: 0 auto; padding: 2rem 0; }
        .timeline::after { content: ''; position: absolute; width: 3px; background-color: var(--color-border); top: 0; bottom: 0; left: 50%; margin-left: -1.5px; }
        .timeline-item { padding: 10px 40px; position: relative; background-color: inherit; width: 50%; }
        .timeline-item.left { left: 0; }
        .timeline-item.right { left: 50%; }
        .timeline-item::after { content: ''; position: absolute; width: 20px; height: 20px; right: -10px; background-color: var(--color-surface); border: 4px solid var(--color-accent); top: 25px; border-radius: 50%; z-index: 1; }
        .timeline-item.right::after { left: -10px; }
        .timeline-content { padding: var(--spacing-unit); background-color: var(--color-surface); position: relative; border-radius: var(--border-radius); box-shadow: var(--shadow-sm); }
        @media screen and (max-width: 768px) {
            .timeline::after { left: 15px; }
            .timeline-item { width: 100%; padding-left: 50px; padding-right: 15px; }
            .timeline-item.left, .timeline-item.right { left: 0%; }
            .timeline-item::after { left: 6px; }
        }

        /* --- SCIENTIST'S GUIDE --- */
        .strategy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-unit); }
        .strategy-card { text-align: center; }
        .strategy-card .icon { margin-bottom: 1rem; }
        .strategy-card .icon svg { width: 50px; height: 50px; color: var(--color-accent); }
        .strategy-card h4 { color: var(--color-primary); }

        /* --- QUIZ --- */
        #quiz-container { background-color: var(--color-surface); border-radius: var(--border-radius); padding: calc(var(--spacing-unit) * 1.5); border: 1px solid var(--color-border); }
        .quiz-question { font-size: 1.2rem; font-weight: 600; margin-bottom: var(--spacing-unit); color: var(--color-heading); }
        .quiz-options { list-style: none; display: flex; flex-direction: column; gap: 1rem; }
        .quiz-option { display: block; width: 100%; padding: 1rem; border: 1px solid var(--color-border); background-color: var(--color-surface); color: var(--color-text); font-size: 1rem; text-align: left; cursor: pointer; border-radius: var(--border-radius); transition: all var(--transition-speed) ease; }
        .quiz-option:not(:disabled):hover { border-color: var(--color-primary); background-color: #e9f5f7; }
        .quiz-option.correct { background-color: #d1e7dd; border-color: var(--color-success); font-weight: 600; }
        .quiz-option.incorrect { background-color: #f8d7da; border-color: var(--color-danger); }
        #quiz-next-btn { padding: 0.75rem 1.5rem; background-color: var(--color-primary); color: white; border: none; border-radius: var(--border-radius); font-size: 1rem; font-weight: 600; cursor: pointer; float: right; margin-top: var(--spacing-unit); }
        #quiz-next-btn:disabled { background-color: var(--color-text-muted); cursor: not-allowed; }
        #quiz-next-btn:hover:not(:disabled) { background-color: var(--color-accent); color: var(--color-heading); }

        /* --- GLOSSARY & FOOTER --- */
        .glossary-item { margin-bottom: 1rem; }
        .glossary-item dt { font-weight: 600; color: var(--color-heading); }
        .footer { text-align: center; padding: calc(var(--spacing-unit) * 2); font-size: 0.9rem; color: var(--color-text-muted); border-top: 1px solid var(--color-border); margin-top: 2rem; }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <a href="#main-content" class="skip-link" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to main content</a>

    <header class="site-header">
        <div class="container">
            <h1>American Science</h1>
            <p class="subtitle">A story of profound challenge, historical achievement, and the enduring resilience of discovery.</p>
        </div>
        <div class="scroll-down-indicator">Scroll to Explore</div>
    </header>

    <main id="main-content">

        <section id="threat" class="fade-in-section">
            <div class="container">
                <div class="section-intro">
                    <h2>The Unraveling Begins</h2>
                    <p>Proposed 2026 budget cuts represent a radical break from the past, threatening to dismantle key scientific institutions and halt progress across critical fields.</p>
                </div>
                
                <div class="data-viz-grid">
                    <div class="info-card stat-card">
                        <div class="agency-name">NIH</div>
                        <div class="cut-value">-40%</div>
                        <p class="stat-description">Health research slashed, institutes consolidated.</p>
                    </div>
                    <div class="info-card stat-card">
                        <div class="agency-name">NASA Science</div>
                        <div class="cut-value">-50%</div>
                        <p class="stat-description">Planetary exploration budget halved.</p>
                    </div>
                    <div class="info-card stat-card">
                        <div class="agency-name">DOE Renewables</div>
                        <div class="cut-value">-100%</div>
                        <p class="stat-description">Wind, solar, and grid programs eliminated.</p>
                    </div>
                     <div class="info-card stat-card">
                        <div class="agency-name">NSF Overall</div>
                        <div class="cut-value">-50%+</div>
                        <p class="stat-description">Fundamental research funding faces deep cuts.</p>
                    </div>
                </div>

                <h3 style="margin-top: 3rem; text-align: center;">NSF Directorate Cuts: A Closer Look</h3>
                <div id="nsf-chart-container" class="info-card">
                    <svg id="nsf-chart-svg" width="100%" height="400" aria-label="Bar chart showing proposed cuts to NSF directorates."></svg>
                </div>
            </div>
        </section>

        <section id="casualties" class="fade-in-section" style="background-color: var(--color-surface);">
             <div class="container">
                <div class="section-intro">
                    <h2>Scientific Casualties</h2>
                    <p>These are not just numbers on a page. The cuts mean the cancellation of groundbreaking projects and the loss of irreplaceable infrastructure.</p>
                </div>
                <div class="data-table-container">
                    <table class="data-table">
                        <caption>High-Profile Projects and Facilities Impacted</caption>
                        <thead>
                            <tr>
                                <th>Agency</th>
                                <th>Project / Facility</th>
                                <th>Status Under Proposed Cuts</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>NASA</td>
                                <td>Mars Sample Return</td>
                                <td><strong>Canceled.</strong> A multi-decade effort to bring Martian rocks to Earth would end.</td>
                            </tr>
                            <tr>
                                <td>NSF</td>
                                <td>LIGO Detector</td>
                                <td><strong>One of two detectors shut down.</strong> Reversing progress in gravitational wave astronomy.</td>
                            </tr>
                            <tr>
                                <td>NSF</td>
                                <td>Thirty Meter Telescope</td>
                                <td><strong>Canceled.</strong> Funding for one of the world's most powerful next-gen telescopes eliminated.</td>
                            </tr>
                             <tr>
                                <td>NASA</td>
                                <td>Juno & New Horizons</td>
                                <td><strong>Operations ended.</strong> Active missions returning unprecedented data from Jupiter and beyond would be terminated.</td>
                            </tr>
                            <tr>
                                <td>NSF</td>
                                <td>Kitt Peak / Cerro Tololo</td>
                                <td><strong>Access phased out.</strong> Historic observatories would be transferred, reducing access for US astronomers.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="multiplier" class="fade-in-section">
            <div class="container">
                <div class="section-intro">
                    <h2>The Multiplier Effect</h2>
                    <p>Every dollar invested in scientific research has a cascading effect, generating immense economic, social, and technological returns far beyond the initial scope.</p>
                </div>
                <div id="roi-infographic">
                    <div class="roi-benefit">
                        <div class="icon">🔬</div>
                        <h4>Educated Workforce</h4>
                        <p>Funds graduate students and postdocs, training the next generation of innovators.</p>
                    </div>
                    <div class="roi-benefit">
                        <div class="icon">💼</div>
                        <h4>Direct Jobs</h4>
                        <p>Employs researchers, lab technicians, and administrative staff.</p>
                    </div>
                    <div class="roi-benefit">
                        <div class="icon">🏭</div>
                        <h4>Indirect Jobs</h4>
                        <p>Supports a vast supply chain of equipment vendors and service providers.</p>
                    </div>
                    <div class="roi-center">
                        <div class="roi-center-circle">
                            <span class="amount">$1</span>
                            <span class="label">in Research</span>
                        </div>
                    </div>
                    <div class="roi-benefit">
                        <div class="icon">💡</div>
                        <h4>New Companies</h4>
                        <p>Discoveries lead to patents, licenses, and high-tech startups.</p>
                    </div>
                    <div class="roi-benefit">
                        <div class="icon">❤️</div>
                        <h4>Health & Well-being</h4>
                        <p>Leads to new treatments, longer lifespans, and improved quality of life.</p>
                    </div>
                    <div class="roi-benefit">
                        <div class="icon">📈</div>
                        <h4>Economic Growth</h4>
                        <p>Studies show $1 in NIH funding generates over $2 in local economic output.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="echoes" class="fade-in-section" style="background-color: var(--color-surface);">
            <div class="container">
                <div class="section-intro">
                    <h2>Echoes of Discovery</h2>
                    <p>Today's essential technologies are the direct result of yesterday's bold, long-term public investment in fundamental research.</p>
                </div>
                <div class="timeline">
                    <div class="timeline-item left">
                        <div class="timeline-content">
                            <h3>1973: Global Positioning System (GPS)</h3>
                            <p>Born from a Department of Defense project, sustained government funding built a satellite constellation for military use. Today, this public utility powers global logistics, navigation apps, and countless industries, creating trillions in economic value.</p>
                        </div>
                    </div>
                    <div class="timeline-item right">
                        <div class="timeline-content">
                            <h3>1990: Human Genome Project</h3>
                            <p>A $3.8 billion, 13-year public investment by the NIH and DOE to map our DNA. The resulting data, made freely available, ignited the biotech revolution and has returned an estimated $1 trillion to the US economy—a 178-to-1 return on investment.</p>
                        </div>
                    </div>
                    <div class="timeline-item left">
                        <div class="timeline-content">
                            <h3>2020: mRNA Vaccines</h3>
                            <p>The rapid development of COVID-19 vaccines was possible only because of decades of prior, often obscure, NIH and NSF-funded research into messenger RNA. This foundational science provided the toolkit to save millions of lives when crisis struck.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="guide" class="fade-in-section">
            <div class="container">
                 <div class="section-intro">
                    <h2>A Scientist's Guide to Thriving</h2>
                    <p>In a climate of uncertainty, the scientific community's greatest strengths—ingenuity, collaboration, and resilience—are more critical than ever. Here are pathways to keep discovery alive.</p>
                </div>
                <div class="strategy-grid">
                    <div class="info-card strategy-card">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2zm0 2a8 8 0 100 16 8 8 0 000-16zm-1 5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm-2 5a1 1 0 011-1h6a1 1 0 110 2H8a1 1 0 01-1-1zm2-5a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z"/></svg>
                        </div>
                        <h4>Embrace Open Science</h4>
                        <p>Share data, code, and pre-prints openly to accelerate discovery and build on each other's work more efficiently. This reduces duplicative effort and maximizes the value of every research dollar.</p>
                    </div>
                     <div class="info-card strategy-card">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11 15.586l-3.293-3.293a1 1 0 00-1.414 1.414l4 4a1 1 0 001.414 0l9-9a1 1 0 00-1.414-1.414L11 15.586zM12 2a5 5 0 100 10 5 5 0 000-10zm0-2a7 7 0 110 14 7 7 0 010-14z"/></svg>
                        </div>
                        <h4>Forge Industry Partnerships</h4>
                        <p>Collaborate with private sector companies that have a vested interest in your research area. These partnerships can provide direct funding, access to specialized equipment, and a clear path to real-world application.</p>
                    </div>
                     <div class="info-card strategy-card">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22a10 10 0 100-20 10 10 0 000 20zm0-2a8 8 0 110-16 8 8 0 010 16zm-5-8.5a1 1 0 011-1h8a1 1 0 110 2H8a1 1 0 01-1-1z"/></svg>
                        </div>
                        <h4>Seek Philanthropic Funding</h4>
                        <p>Foundations like the Gates Foundation, Wellcome Trust, and Chan Zuckerberg Initiative are increasingly funding ambitious, high-risk, high-reward science that federal agencies may no longer support.</p>
                    </div>
                    <div class="info-card strategy-card">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm6.364 7.636a1 1 0 01-1.414 1.414L15 9.121V14a1 1 0 11-2 0V9.121l-1.95 1.95a1 1 0 01-1.414-1.414l3.536-3.536a1.5 1.5 0 012.121 0l3.071 3.071zM10.5 16a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/></svg>
                        </div>
                        <h4>Leverage Citizen Science</h4>
                        <p>Engage the public in data collection and analysis. Projects like Foldit and Zooniverse show that distributed networks of volunteers can solve complex problems and generate massive datasets at low cost.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="quiz" class="fade-in-section">
            <div class="container">
                <div class="section-intro">
                    <h2>Check Your Understanding</h2>
                    <p>Based on the story, how well do you grasp the stakes and strategies?</p>
                </div>
                <div id="quiz-container"></div>
            </div>
        </section>

        <section id="glossary" class="fade-in-section">
            <div class="container">
                <div class="section-intro">
                    <h2>Glossary of Terms</h2>
                </div>
                <dl id="glossary-container">
                    <!-- Glossary content injected by JS -->
                </dl>
            </div>
        </section>

    </main>

    <footer class="footer">
        <p>This interactive narrative was created based on the provided source material regarding proposed 2026 US science budget cuts, historical data, and strategies for scientific resilience.</p>
    </footer>

<script>
(function() {
    'use strict';

    /**
     * MODULE: Particle background
     */
    const Particles = {
        init() {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                return;
            }
            const canvas = document.createElement('canvas');
            const container = document.getElementById('particles-js');
            if (!container) return;
            container.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let particles = [];
            const particleCount = 50;

            const resize = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };

            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.vx = Math.random() * 0.4 - 0.2;
                    this.vy = Math.random() * 0.4 - 0.2;
                    this.radius = Math.random() * 1.5 + 0.5;
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 95, 115, 0.4)';
                    ctx.fill();
                }
            }

            const createParticles = () => {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }
            };

            const animate = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            };

            window.addEventListener('resize', () => {
                resize();
                createParticles();
            });
            
            resize();
            createParticles();
            animate();
        }
    };
    
    /**
     * MODULE: Scroll Animator
     */
    const ScrollAnimator = {
        init() {
            const sections = document.querySelectorAll('.fade-in-section');
            if (!('IntersectionObserver' in window)) {
                sections.forEach(section => section.classList.add('is-visible'));
                return;
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        if (entry.target.id === 'threat') Charts.init();
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            sections.forEach(section => observer.observe(section));
        }
    };

    /**
     * MODULE: Charts
     */
    const Charts = {
        nsfData: [
            { category: 'Biology', current: 100, proposed: 30 }, // ~70% cut
            { category: 'Engineering', current: 100, proposed: 30 }, // ~70% cut
            { category: 'Comp. Sci', current: 100, proposed: 40 }, // ~60% cut
            { category: 'Math/Phys', current: 100, proposed: 40 }, // ~60% cut
            { category: 'Intl. Prog.', current: 100, proposed: 20 }, // 80% cut
        ],
        init() {
            this.createNSFChart();
        },
        createNSFChart() {
            const svg = document.getElementById('nsf-chart-svg');
            if (!svg || svg.dataset.rendered) return;
            svg.dataset.rendered = 'true';
            
            const svgWidth = svg.clientWidth;
            const svgHeight = 400;
            const margin = { top: 40, right: 20, bottom: 60, left: 80 };
            const chartWidth = svgWidth - margin.left - margin.right;
            const chartHeight = svgHeight - margin.top - margin.bottom;

            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', `translate(${margin.left}, ${margin.top})`);
            svg.appendChild(g);

            // X and Y scales
            const yScale = (index) => index * (chartHeight / this.nsfData.length);
            const barHeight = (chartHeight / this.nsfData.length) * 0.8;
            const xScale = (value) => (value / 100) * chartWidth;

            // Legend
            const legendData = [{label: 'Current', color: 'var(--color-primary)'}, {label: 'Proposed', color: '#e5989b'}];
            legendData.forEach((item, i) => {
                const legendGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                legendGroup.setAttribute('transform', `translate(${i * 100}, -20)`);
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('width', 15);
                rect.setAttribute('height', 15);
                rect.setAttribute('fill', item.color);
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.textContent = item.label;
                text.setAttribute('x', 20);
                text.setAttribute('y', 12);
                text.style.fontSize = '14px';
                legendGroup.appendChild(rect);
                legendGroup.appendChild(text);
                g.appendChild(legendGroup);
            });

            // Bars and labels
            this.nsfData.forEach((d, i) => {
                const barGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                barGroup.classList.add('bar-group');
                barGroup.setAttribute('transform', `translate(0, ${yScale(i)})`);

                // Y-axis label
                const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                yLabel.textContent = d.category;
                yLabel.setAttribute('x', -10);
                yLabel.setAttribute('y', barHeight / 2 + 5);
                yLabel.setAttribute('text-anchor', 'end');
                yLabel.classList.add('axis-label');
                barGroup.appendChild(yLabel);

                // Current bar
                const currentBar = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                currentBar.classList.add('bar-current');
                currentBar.setAttribute('y', 0);
                currentBar.setAttribute('height', barHeight / 2);
                currentBar.setAttribute('width', 0);
                currentBar.style.transition = `width 1.5s ${i * 0.1}s ease-out`;
                barGroup.appendChild(currentBar);

                // Proposed bar
                const proposedBar = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                proposedBar.classList.add('bar-proposed');
                proposedBar.setAttribute('y', barHeight / 2);
                proposedBar.setAttribute('height', barHeight / 2);
                proposedBar.setAttribute('width', 0);
                proposedBar.style.transition = `width 1.5s ${i * 0.1 + 0.1}s ease-out`;
                barGroup.appendChild(proposedBar);

                // Cut percentage label
                const cutLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                const cut = 100 - d.proposed;
                cutLabel.textContent = `-${cut}%`;
                cutLabel.setAttribute('x', xScale(d.proposed) + 5);
                cutLabel.setAttribute('y', barHeight * 0.75 + 5);
                cutLabel.classList.add('bar-label');
                cutLabel.style.fill = 'var(--color-danger)';
                cutLabel.style.opacity = 0;
                cutLabel.style.transition = `opacity 0.5s ${i * 0.1 + 1.5}s ease`;
                barGroup.appendChild(cutLabel);

                g.appendChild(barGroup);
                
                // Trigger animation
                setTimeout(() => {
                    currentBar.setAttribute('width', xScale(d.current));
                    proposedBar.setAttribute('width', xScale(d.proposed));
                    cutLabel.style.opacity = 1;
                }, 100);
            });
        }
    };

    /**
     * MODULE: Quiz
     */
    const Quiz = {
        quizData: [
            { question: "What is the estimated economic return for every $1 invested in the Human Genome Project?", options: ["$10 to 1", "$50 to 1", "$178 to 1", "$2 to 1"], answer: "$178 to 1" },
            { question: "Which major NASA mission, aiming to bring Martian rocks to Earth, faces cancellation?", options: ["James Webb Telescope", "Mars Sample Return", "Juno Mission", "Perseverance Rover"], answer: "Mars Sample Return" },
            { question: "Which is NOT a suggested strategy for scientists in the 'Guide to Thriving'?", options: ["Seeking philanthropic funding", "Working in complete isolation", "Forging industry partnerships", "Embracing Open Science"], answer: "Working in complete isolation" },
            { question: "The rapid development of mRNA vaccines was built on decades of foundational research funded primarily by:", options: ["Private corporations", "NIH and NSF", "International consortiums", "Crowdfunding"], answer: "NIH and NSF" },
            { question: "What is the proposed cut for the NSF's International Programs, critical for global collaboration?", options: ["-20%", "-40%", "-60%", "-80%"], answer: "-80%" }
        ],
        current: 0, score: 0,
        init() {
            this.container = document.getElementById('quiz-container');
            if(this.container) this.renderQuestion();
        },
        renderQuestion() {
            if (this.current >= this.quizData.length) { this.showScore(); return; }
            const q = this.quizData[this.current];
            this.container.innerHTML = `
                <p>${this.current + 1} / ${this.quizData.length}</p>
                <p class="quiz-question">${q.question}</p>
                <div class="quiz-options">
                    ${q.options.map(o => `<button class="quiz-option" data-answer="${o}">${o}</button>`).join('')}
                </div>
                <button id="quiz-next-btn" disabled>Next</button>`;
            this.addListeners();
        },
        addListeners() {
            this.container.querySelectorAll('.quiz-option').forEach(o => o.addEventListener('click', e => this.handleAnswer(e)));
            document.getElementById('quiz-next-btn').addEventListener('click', () => { this.current++; this.renderQuestion(); });
        },
        handleAnswer(e) {
            const selected = e.target;
            const answer = this.quizData[this.current].answer;
            this.container.querySelectorAll('.quiz-option').forEach(o => {
                o.disabled = true;
                if(o.dataset.answer === answer) o.classList.add('correct');
            });
            if (selected.dataset.answer === answer) {
                this.score++;
                selected.classList.add('correct');
            } else {
                selected.classList.add('incorrect');
            }
            document.getElementById('quiz-next-btn').disabled = false;
        },
        showScore() {
            this.container.innerHTML = `
                <div style="text-align:center;">
                    <h3>Quiz Complete!</h3>
                    <p>You scored:</p>
                    <div style="font-size: 3rem; color: var(--color-primary);">${this.score} / ${this.quizData.length}</div>
                    <button id="quiz-restart-btn" style="margin-top:1rem; padding: 0.75rem 1.5rem; background-color: var(--color-accent);">Try Again</button>
                </div>`;
            document.getElementById('quiz-restart-btn').addEventListener('click', () => { this.current = 0; this.score = 0; this.renderQuestion(); });
        }
    };
    
    /**
     * MODULE: Glossary
     */
    const Glossary = {
        glossaryData: {
            "NIH (National Institutes of Health)": "The primary U.S. agency responsible for biomedical and public health research.",
            "NSF (National Science Foundation)": "An independent federal agency that supports fundamental research and education in non-medical fields of science and engineering.",
            "LIGO (Laser Interferometer Gravitational-Wave Observatory)": "A large-scale physics experiment designed to detect cosmic gravitational waves.",
            "Open Science": "A movement to make scientific research, data, and dissemination accessible to all levels of society.",
            "Philanthropic Funding": "Support for research provided by private foundations or charitable organizations rather than government or for-profit companies."
        },
        init() {
            const container = document.getElementById('glossary-container');
            if(!container) return;
            container.innerHTML = Object.entries(this.glossaryData).map(([term, def]) => `
                <div class="glossary-item">
                    <dt>${term}</dt>
                    <dd>${def}</dd>
                </div>`).join('');
        }
    };

    /**
     * APP INITIALIZATION
     */
    function initialize() {
        if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) {
            Particles.init();
            ScrollAnimator.init();
            Quiz.init();
            Glossary.init();
        } else {
            document.addEventListener('DOMContentLoaded', () => {
                Particles.init();
                ScrollAnimator.init();
                Quiz.init();
                Glossary.init();
            });
        }
    }
    initialize();

})();
</script>

<script type="module" id="test-suite">
    class TestSuite {
        constructor(name) { this.name = name; this.tests = []; this.passed = 0; this.failed = 0; }
        test(desc, fn) { this.tests.push({ desc, fn }); }
        assert(cond, msg) { if (!cond) throw new Error(msg || 'Assertion failed'); }
        async run() {
            console.group(`🔬 Running Test Suite: ${this.name}`);
            for (const { desc, fn } of this.tests) {
                try { await fn(); console.log(`✅ PASS: ${desc}`); this.passed++; }
                catch (e) { console.error(`❌ FAIL: ${desc}`); console.error(e); this.failed++; }
            }
            console.groupEnd(); this.report();
        }
        report() {
            console.group("📊 Test Report");
            console.log(`Total: ${this.tests.length}, Passed: ${this.passed}, Failed: ${this.failed}`);
            console.groupEnd();
        }
    }
    const suite = new TestSuite("Interactive Narrative v2 Integrity");
    suite.test("Document Structure: New sections are present", () => {
        suite.assert(document.getElementById('threat'), "#threat section exists.");
        suite.assert(document.getElementById('casualties'), "#casualties section exists.");
        suite.assert(document.getElementById('multiplier'), "#multiplier section exists.");
        suite.assert(document.getElementById('echoes'), "#echoes section exists.");
        suite.assert(document.getElementById('guide'), "#guide section exists.");
    });
    suite.test("Data Visualization: Key elements are in the DOM", () => {
        suite.assert(document.getElementById('nsf-chart-svg'), "NSF Chart SVG container exists.");
        suite.assert(document.querySelector('.data-table'), "Casualties data table exists.");
        suite.assert(document.querySelector('.timeline'), "Historical timeline exists.");
        suite.assert(document.getElementById('roi-infographic'), "ROI infographic exists.");
    });
    suite.test("Accessibility: Core features are implemented", () => {
        suite.assert(document.querySelector('html[lang="en"]'), "HTML lang attribute is 'en'.");
        suite.assert(document.querySelector('a.skip-link'), "Skip-to-content link is present.");
        const sectionsWithLabels = document.querySelectorAll('section[id]');
        suite.assert(sectionsWithLabels.length > 5, "Sections have IDs for linking.");
    });
    suite.test("Content Initialization: Dynamic modules populate content", async () => {
        await new Promise(resolve => setTimeout(resolve, 200)); // wait for DOMContentLoaded
        suite.assert(document.querySelector('#quiz-container .quiz-question'), "Quiz question should be rendered.");
        suite.assert(document.querySelectorAll('#glossary-container .glossary-item').length > 0, "Glossary items should be rendered.");
        suite.assert(document.querySelectorAll('#nsf-chart-svg .bar-group').length > 0, "NSF Chart bars should be rendered on visibility (requires manual scroll check, but JS module should be ready).");
    });
    window.addEventListener('load', () => suite.run());
</script>
</body>
</html>
